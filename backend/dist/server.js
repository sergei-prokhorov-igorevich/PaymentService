(()=>{"use strict";var e={913:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.apiUrl=t.port=t.host=void 0,t.host="http://127.0.0.1";var n=process.env.PORT||81;t.port=n,t.apiUrl="/api/v1"},349:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.EHttpStatusCode=void 0,function(e){e[e.Ok=200]="Ok",e[e.BadRequest=400]="BadRequest",e[e.NotFound=404]="NotFound"}(n||(n={})),t.EHttpStatusCode=n},279:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.logError=t.logWarning=t.logInfo=t.logDebug=t.logVerbose=void 0;var r=n(729);t.logVerbose=function(e,t){return(0,r.log)(r.ELogLevel.Verbose,e,t)},t.logDebug=function(e,t){return(0,r.log)(r.ELogLevel.Debug,e,t)},t.logInfo=function(e,t){return(0,r.log)(r.ELogLevel.Info,e,t)},t.logWarning=function(e,t){return(0,r.log)(r.ELogLevel.Warning,e,t)},t.logError=function(e,t){return(0,r.log)(r.ELogLevel.Error,e,t)}},729:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function c(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(u){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,u])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.logsFilePath=t.log=t.initLogger=t.ELogLevel=void 0;var i,a=n(612),c=n(292),u=n(17),s=n(147),l=u.resolve("".concat(__dirname,"/../logs/")),f="".concat(l,"/").concat(s.name,".txt");t.logsFilePath=f,function(e){e[e.Verbose=0]="Verbose",e[e.Debug=1]="Debug",e[e.Info=2]="Info",e[e.Warning=3]="Warning",e[e.Error=4]="Error"}(i||(i={})),t.ELogLevel=i,t.initLogger=function(){return r(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,4]),[4,c.stat(l)];case 1:case 3:return e.sent(),[3,4];case 2:return e.sent(),[4,c.mkdir(l)];case 4:return e.trys.push([4,6,,8]),[4,c.stat(f)];case 5:case 7:return e.sent(),[3,8];case 6:return e.sent(),[4,c.writeFile(f,"")];case 8:return[2]}}))}))},t.log=function(e,t,n){return r(this,void 0,void 0,(function(){var r,u;return o(this,(function(o){switch(o.label){case 0:return r={datetime:(new Date).toISOString(),level:i[e],message:t,obj:n},u="".concat(JSON.stringify(r)).concat(a.EOL),[4,c.appendFile(f,u)];case 1:return o.sent(),[2,u]}}))}))}},876:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function c(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(u){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,u])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.startWebSocket=void 0;var i=n(952),a=n(279),c=n(913),u=n(822);t.startWebSocket=function(e){var t=this;new i.Server(e,{cors:{origin:[c.host]}}).on("connection",(function(e){return r(t,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return[4,(0,a.logVerbose)("WebSocket(id:".concat(e.id,") connected"))];case 1:return n.sent(),e.on("disconnecting",(function(){(0,u.terminateWorker)(),(0,a.logVerbose)("WebSocket(id:".concat(e.id,") disconnected"))})),(0,u.terminateWorker)(),(0,u.runWorker)(),t=function(t){return e.emit("message",t)},(0,u.onMessageWorker)(t),[2]}}))}))}))}},822:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.terminateWorker=t.onMessageWorker=t.runWorker=void 0;var r,o=n(86);t.runWorker=function(){r||(console.log('Worker "fileLogWorker" started.'),(r=new o.Worker(__dirname+"/fileLogWorker.js")).on("exit",(function(){console.log('Worker "fileLogWorker" exited.'),r=null})))},t.onMessageWorker=function(e){r.on("message",e)},t.terminateWorker=function(){null==r||r.terminate()}},607:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function c(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(u){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(860),a=n(582),c=n(428),u=n(876),s=n(729),l=n(356),f=n(913);r(void 0,void 0,void 0,(function(){var e,t,n,r;return o(this,(function(o){switch(o.label){case 0:return[4,(0,s.initLogger)()];case 1:return o.sent(),[4,(0,l.connectMongoDb)()];case 2:return o.sent(),n=(t=i().use(a()).use(i.json())).use,r=["".concat(f.apiUrl,"/order")],[4,(0,c.createOrderRouter)()];case 3:return e=n.apply(t,r.concat([o.sent()])).listen(f.port,(function(){return console.log("Server started at ".concat(f.host,":").concat(f.port).concat(f.apiUrl))})),(0,u.startWebSocket)(e),[2]}}))}))},608:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function c(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(u){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,u])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.payByOrder=t.getOrderByGuid=void 0;var i=n(720);t.getOrderByGuid=function(e){return r(void 0,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,i.Order.findOne({orderGuid:e})];case 1:return[2,t.sent()]}}))}))},t.payByOrder=function(e,t){return r(void 0,void 0,void 0,(function(){var n;return o(this,(function(r){switch(r.label){case 0:return t?(n=Boolean,[4,i.Order.findOne({orderGuid:e})]):[2,!1];case 1:return[2,n.apply(void 0,[r.sent()])]}}))}))}},356:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function c(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(u){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,u])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.connectMongoDb=void 0;var i=n(185),a=n(285);t.connectMongoDb=function(){return r(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return i.connection.on("error",console.error.bind(console,"Mongoose connection error: ")),i.connection.once("open",(function(){return console.log("Mongoose connected successfully")})),[4,(0,i.connect)(a.mongodbConnectionString,{dbName:"PaymentService"})];case 1:return e.sent(),[2]}}))}))}},720:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Order=void 0;var r=n(185),o=new r.Schema({orderGuid:String,orderId:String,payerId:String,amount:Number,currency:String,paymentMethod:String}),i=(0,r.model)("Order",o,"orders");t.Order=i},285:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.mongodbConnectionString=void 0,t.mongodbConnectionString="mongodb://test:1234567890@ac-jtr4crw-shard-00-00.ewby6hr.mongodb.net:27017,ac-jtr4crw-shard-00-01.ewby6hr.mongodb.net:27017,ac-jtr4crw-shard-00-02.ewby6hr.mongodb.net:27017/?ssl=true&replicaSet=atlas-8y3te6-shard-0&authSource=admin&retryWrites=true&w=majority"},428:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function c(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(u){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,u])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.createOrderRouter=void 0;var i=n(860),a=n(608),c=n(349),u=n(279);t.createOrderRouter=function(){return r(void 0,void 0,void 0,(function(){var e;return o(this,(function(t){return(e=(0,i.Router)()).get("/:orderGuid",(function(e,t){return r(void 0,void 0,void 0,(function(){var n,r;return o(this,(function(o){switch(o.label){case 0:return n=e.params.orderGuid,(0,u.logVerbose)("Get order '".concat(n,"'.")),[4,(0,a.getOrderByGuid)(n)];case 1:return(r=o.sent())?t.send(r):((0,u.logVerbose)("Order '".concat(n,"' not found.")),t.sendStatus(c.EHttpStatusCode.NotFound)),[2]}}))}))})),e.post("/:orderGuid",(function(e,t){return r(void 0,void 0,void 0,(function(){var n,r,i,s;return o(this,(function(o){switch(o.label){case 0:return n=e.params.orderGuid,r=e.body.password,(0,u.logVerbose)("Pay by order '".concat(n,"'.")),r?[4,(0,a.payByOrder)(n,r)]:((0,u.logVerbose)("password is empty."),t.sendStatus(c.EHttpStatusCode.BadRequest),[2]);case 1:return i=o.sent(),s=i?c.EHttpStatusCode.Ok:c.EHttpStatusCode.NotFound,t.sendStatus(s),[2]}}))}))})),[2,e]}))}))}},582:e=>{e.exports=require("cors")},860:e=>{e.exports=require("express")},185:e=>{e.exports=require("mongoose")},952:e=>{e.exports=require("socket.io")},292:e=>{e.exports=require("fs/promises")},612:e=>{e.exports=require("node:os")},86:e=>{e.exports=require("node:worker_threads")},17:e=>{e.exports=require("path")},147:e=>{e.exports=JSON.parse('{"name":"simple-payment-service-backend","description":"It\'s a simple payment service application. https://github.com/sergei-prokhorov-igorevich/PaymentService/tree/main/","author":"Sergei Prokhorov","version":"1.0.0","private":true,"scripts":{"build":"webpack","watch":"webpack --watch","server":"cross-env PORT=81 nodemon dist/server.js --watch dist -e js","start":"npm-run-all -p watch server"},"keywords":[],"license":"ISC","devDependencies":{"@types/cors":"^2.8.13","@types/express":"^4.17.17","@types/node":"^20.1.5","@typescript-eslint/eslint-plugin":"^5.59.6","@typescript-eslint/parser":"^5.59.6","cross-env":"^7.0.3","eslint":"^8.40.0","eslint-config-airbnb":"^19.0.4","eslint-config-airbnb-typescript":"^17.0.0","eslint-config-standard-with-typescript":"^34.0.1","eslint-plugin-import":"^2.27.5","eslint-plugin-jsx-a11y":"^6.7.1","eslint-plugin-n":"^15.7.0","eslint-plugin-promise":"^6.1.1","nodemon":"^2.0.22","npm-run-all":"^4.1.5","ts-loader":"^9.4.3","ts-node":"^10.9.1","typescript":"^5.0.4","webpack":"^5.85.0","webpack-cli":"^5.1.2","webpack-node-externals":"^3.0.0"},"dependencies":{"cors":"^2.8.5","express":"^4.18.2","mongodb":"^5.5.0","mongoose":"^7.3.0","socket.io":"^4.6.2"}}')}},t={};!function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r].call(i.exports,i,i.exports,n),i.exports}(607)})();